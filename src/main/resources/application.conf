akka {

  extensions = [
    "com.romix.akka.serialization.kryo.KryoSerializationExtension$",
    "akka.cluster.metrics.ClusterMetricsExtension",
    "akka.cluster.pubsub.DistributedPubSub"]

  actor {

    provider = "akka.cluster.ClusterActorRefProvider"

    // deployment {
    //   /storekeepers {
    //     dispatcher = control-aware-dispatcher
    //     router = consistent-hashing-pool
    //     cluster {
    //       enabled = on
    //       max-nr-of-instances-per-node = 25
    //       allow-local-routees = on
    //     }
    //   }
    // }

    kryo  {
      type = "nograph"
      idstrategy = "automatic"
      buffer-size = 4096
      max-buffer-size = -1
      use-manifests = false
      implicit-registration-logging = false
      kryo-trace = false
      mappings {
        "com.actorbase.actorsystem.messages.MainMessages.MainMessage" = 20,
        "com.actorbase.actorsystem.messages.ClientActorMessages.MapResponse" = 21,
        "com.actorbase.actorsystem.messages.AuthActorMessages.AuthActorMessages" = 22,
        "com.actorbase.actorsystem.messages.StorefinderMessages.StorefinderMessage" = 24,
        "com.actorbase.actorsystem.messages.StorekeeperMessages.StorekeeperMessage" = 25,
        "com.actorbase.actorsystem.messages.WarehousemanMessages.WarehousemanMessage" = 26,
        "com.actorbase.actorsystem.actors.manager.Manager$OneMore$" = 27,
        "com.actorbase.actorsystem.messages.StorefinderMessages.UpdateCollectionSize" = 28,
        "com.actorbase.actorsystem.messages.MainMessages.CreateCollection" = 29,
        "com.actorbase.actorsystem.messages.MainMessages.InsertTo" = 30,
        "com.actorbase.actorsystem.messages.MainMessages.CompleteTransaction" = 31,
        "com.actorbase.actorsystem.messages.StorefinderMessages.PartialMapTransaction" = 32,
        "com.actorbase.actorsystem.messages.StorekeeperMessages.GetAll" = 33,
        "com.actorbase.actorsystem.messages.StorekeeperMessages.GetItem" = 34,
        "com.actorbase.actorsystem.messages.StorekeeperMessages.InsertItem" = 35,
        "com.actorbase.actorsystem.messages.StorekeeperMessages.RemoveItem" = 36
      }

      classes = [
        "com.actorbase.actorsystem.messages.MainMessages.MainMessage",
        "com.actorbase.actorsystem.messages.ClientActorMessages.MapResponse",
        "com.actorbase.actorsystem.messages.AuthActorMessages.AuthActorMessages",
        "com.actorbase.actorsystem.messages.StorefinderMessages.StorefinderMessage",
        "com.actorbase.actorsystem.messages.StorekeeperMessages.StorekeeperMessage",
        "com.actorbase.actorsystem.messages.WarehousemanMessages.WarehousemanMessage",
        "com.actorbase.actorsystem.actors.manager.Manager$OneMore$",
        "com.actorbase.actorsystem.messages.StorefinderMessages.UpdateCollectionSize",
        "com.actorbase.actorsystem.messages.MainMessages.CreateCollection",
        "com.actorbase.actorsystem.messages.MainMessages.InsertTo",
        "com.actorbase.actorsystem.messages.MainMessages.CompleteTransaction",
        "com.actorbase.actorsystem.messages.StorefinderMessages.PartialMapTransaction",
        "com.actorbase.actorsystem.messages.StorekeeperMessages.GetAll",
        "com.actorbase.actorsystem.messages.StorekeeperMessages.GetItem",
        "com.actorbase.actorsystem.messages.StorekeeperMessages.InsertItem",
        "com.actorbase.actorsystem.messages.StorekeeperMessages.RemoveItem"
      ]
    }

    serializers {
      // java = "akka.serialization.JavaSerializer"
      // proto = "akka.remote.serialization.ProtobufSerializer"
      // akka-cluster = "akka.cluster.protobuf.ClusterMessageSerializer"
      kryo = "com.romix.akka.serialization.kryo.KryoSerializer"
    }
    serialization-bindings {
      // "akka.cluster.ClusterMessage" = akka-cluster
      // "java.lang.String" = java
      "com.actorbase.actorsystem.messages.MainMessages.CreateCollection" = kryo
      "com.actorbase.actorsystem.messages.MainMessages.InsertTo" = kryo
      "com.actorbase.actorsystem.messages.MainMessages.CompleteTransaction" = kryo
      "com.actorbase.actorsystem.messages.MainMessages.GetFrom" = kryo
      "com.actorbase.actorsystem.messages.StorefinderMessages.PartialMapTransaction" = kryo
      "com.actorbase.actorsystem.messages.StorefinderMessages.UpdateCollectionSize" = kryo
      "com.actorbase.actorsystem.messages.StorekeeperMessages.GetAll" = kryo
      "com.actorbase.actorsystem.messages.StorekeeperMessages.GetItem" = kryo
      "com.actorbase.actorsystem.messages.StorekeeperMessages.InsertItem" = kryo
      "com.actorbase.actorsystem.messages.StorekeeperMessages.RemoveItem" = kryo
      "com.actorbase.actorsystem.messages.ClientActorMessages.MapResponse" = kryo
      "com.actorbase.actorsystem.messages.AuthActorMessages.AuthActorMessages" = kryo
      "com.actorbase.actorsystem.messages.MainMessages.MainMessage" = kryo
      "com.actorbase.actorsystem.messages.StorefinderMessages.StorefinderMessage" = kryo
      "com.actorbase.actorsystem.messages.StorekeeperMessages.StorekeeperMessage" = kryo
      "com.actorbase.actorsystem.messages.WarehousemanMessages.WarehousemanMessage" = kryo
      "com.actorbase.actorsystem.actors.manager.Manager$OneMore$" = kryo,
      "com.actorbase.actorsystem.messages.StorefinderMessages.UpdateCollectionSize" = kryo
    }
  }

  loglevel = "INFO"

  cluster {
    auto-down-unreachable-after = off
   roles = [worker]
   min-nr-of-members = 3
   role {
     master.min-nr-of-members = 1
     worker.min-nr-of-members = 2
   }
    seed-nodes = [
      "akka.tcp://"${name}"@192.168.43.63:2500"]
      // "akka.tcp://"${name}"@192.168.1.107:2501"]

    sharding {
 //     role = "master"
      remember-entities = on
    }

    failure-detector {
      threshold = 12.0
      acceptable-heartbeat-pause = 25s
      heartbeat-interval = 5s
      heartbeat-request {
        expected-response-after = 20s
      }
    }
  }

  remote {
    log-remote-lifecycle-events = off
    maximum-payload-bytes = 100000000 bytes
    netty.tcp {
      log-remote-lifecycle-events = off
      hostname = "127.0.0.1"
      port = 2500
      message-frame-size =  100000000b
      send-buffer-size =  100000000b
      receive-buffer-size =  100000000b
      maximum-frame-size = 100000000b
    }

    transport-failure-detector {
      heartbeat-interval = 30 s
      acceptable-heartbeat-pause = 12 s
    }
  }
}

control-aware-dispatcher {

  // mailbox-type = "akka.dispatch.UnboundedDequeBasedMailbox"
  mailbox-type = "akka.dispatch.UnboundedControlAwareMailbox"
  // fork-join-executor {
  //   Min number of threads to cap factor-based parallelism number to
  //   parallelism-min = 2
  //   Parallelism (threads) ... ceil(available processors * factor)
  //   parallelism-factor = 2.0
  //   Max number of threads to cap factor-based parallelism number to
  //   parallelism-max = 10
  // }
  // throughput = 60
}

spray {
  io {
    read-buffer-size="4kspspray.io.tcp.keep-alive=1"
  }
  can {
    server {
      ssl-encryption = off
    }
  }
}

akka.cluster.metrics.enabled=off
akka.persistence.journal.plugin = "akka.persistence.journal.inmem"
akka.persistence.snapshot-store.plugin = "akka.persistence.snapshot-store.local"
// akka.log-dead-letters=on

akka.contrib.cluster.sharding {
  # role = "master"
}

name = actorbase

listen-on = "127.0.0.1"

exposed-port = 9999

max-instances = 10000

storekeepers-per-node = 30

role = "worker"
